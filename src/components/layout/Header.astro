---
import { NAV_LINKS } from '../../lib/constants';
---

<header
  id="site-header"
  class="fixed top-0 left-0 right-0 bg-[var(--color-navy)] text-white transition-all duration-300"
  style={`z-index: var(--z-sticky);`}
>
  <div class="content-width flex items-center justify-between h-16 lg:h-20">
    <!-- Logo -->
    <a
      href="/"
      class="text-xl lg:text-2xl font-bold tracking-tight text-white hover:text-white no-underline"
      style="font-family: var(--font-heading);"
    >
      IBC Academy
    </a>

    <!-- Desktop Navigation -->
    <nav class="hidden lg:flex items-center gap-8" aria-label="Primary navigation">
      {NAV_LINKS.map((link) => (
        <a
          href={link.href}
          class="text-base font-medium text-white/90 hover:text-[var(--color-gold-light)] transition-colors no-underline"
          style="font-family: var(--font-body);"
        >
          {link.label}
        </a>
      ))}
      <a
        href="/learn/start-here"
        class="inline-flex items-center justify-center text-base font-semibold px-5 py-2.5 rounded-lg bg-[var(--color-gold)] text-white hover:bg-[var(--color-gold-dark)] active:scale-[0.98] transition-all duration-300 no-underline shadow-md hover:shadow-lg"
      >
        Start Learning
      </a>
    </nav>

    <!-- Mobile Hamburger Button -->
    <button
      id="mobile-menu-btn"
      type="button"
      class="lg:hidden flex flex-col justify-center items-center w-10 h-10 gap-1.5 rounded-md hover:bg-white/10 transition-colors"
      aria-label="Open navigation menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <span class="hamburger-bar block w-6 h-0.5 bg-white rounded-full transition-all duration-300 origin-center"></span>
      <span class="hamburger-bar block w-6 h-0.5 bg-white rounded-full transition-all duration-300 origin-center"></span>
      <span class="hamburger-bar block w-6 h-0.5 bg-white rounded-full transition-all duration-300 origin-center"></span>
    </button>
  </div>
</header>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu"
  class="mobile-menu-overlay fixed inset-0 bg-[var(--color-navy)] text-white flex flex-col opacity-0 pointer-events-none transition-opacity duration-300 lg:hidden"
  style={`z-index: var(--z-overlay);`}
  aria-hidden="true"
>
  <!-- Close Button -->
  <div class="flex items-center justify-between h-16 px-[var(--space-lg)]">
    <a
      href="/"
      class="text-xl font-bold tracking-tight text-white hover:text-white no-underline"
      style="font-family: var(--font-heading);"
    >
      IBC Academy
    </a>
    <button
      id="mobile-menu-close"
      type="button"
      class="flex items-center justify-center w-10 h-10 rounded-md hover:bg-white/10 transition-colors"
      aria-label="Close navigation menu"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        aria-hidden="true"
      >
        <line x1="18" y1="6" x2="6" y2="18" />
        <line x1="6" y1="6" x2="18" y2="18" />
      </svg>
    </button>
  </div>

  <!-- Mobile Nav Links -->
  <nav class="flex flex-col items-center justify-center flex-1 gap-6" aria-label="Mobile navigation">
    {NAV_LINKS.map((link) => (
      <a
        href={link.href}
        class="text-2xl font-medium text-white/90 hover:text-[var(--color-gold-light)] transition-colors no-underline"
        style="font-family: var(--font-body);"
      >
        {link.label}
      </a>
    ))}
    <a
      href="/learn/start-here"
      class="mt-4 inline-flex items-center justify-center text-lg font-semibold px-8 py-4 rounded-lg bg-[var(--color-gold)] text-white hover:bg-[var(--color-gold-dark)] active:scale-[0.98] transition-all duration-300 no-underline shadow-md hover:shadow-lg"
    >
      Start Learning
    </a>
  </nav>
</div>

<!-- Spacer for fixed header -->
<div class="h-16 lg:h-20" aria-hidden="true"></div>

<style>
  /* Glassmorphism effect applied when scrolled */
  .header-scrolled {
    background: rgba(27, 42, 74, 0.85) !important;
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  /* Mobile menu open state */
  .mobile-menu-open {
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  /* Remove default link underline on all header/nav links */
  header a,
  .mobile-menu-overlay a {
    text-decoration: none;
  }

  /* Hamburger animation when menu is open */
  .menu-open .hamburger-bar:nth-child(1) {
    transform: translateY(4px) rotate(45deg);
  }
  .menu-open .hamburger-bar:nth-child(2) {
    opacity: 0;
  }
  .menu-open .hamburger-bar:nth-child(3) {
    transform: translateY(-4px) rotate(-45deg);
  }
</style>

<script>
  function initHeader() {
    const header = document.getElementById('site-header');
    const menuBtn = document.getElementById('mobile-menu-btn');
    const menuClose = document.getElementById('mobile-menu-close');
    const mobileMenu = document.getElementById('mobile-menu');

    if (!header || !menuBtn || !menuClose || !mobileMenu) return;

    // Glassmorphism on scroll
    function handleScroll() {
      if (window.scrollY > 20) {
        header.classList.add('header-scrolled');
      } else {
        header.classList.remove('header-scrolled');
      }
    }

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll(); // Check initial scroll position

    // Toggle mobile menu
    function openMenu() {
      mobileMenu.classList.add('mobile-menu-open');
      mobileMenu.setAttribute('aria-hidden', 'false');
      menuBtn.setAttribute('aria-expanded', 'true');
      menuBtn.classList.add('menu-open');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      mobileMenu.classList.remove('mobile-menu-open');
      mobileMenu.setAttribute('aria-hidden', 'true');
      menuBtn.setAttribute('aria-expanded', 'false');
      menuBtn.classList.remove('menu-open');
      document.body.style.overflow = '';
    }

    menuBtn.addEventListener('click', () => {
      const isOpen = menuBtn.getAttribute('aria-expanded') === 'true';
      if (isOpen) {
        closeMenu();
      } else {
        openMenu();
      }
    });

    menuClose.addEventListener('click', closeMenu);

    // Close menu on link click
    const mobileLinks = mobileMenu.querySelectorAll('a');
    mobileLinks.forEach((link) => {
      link.addEventListener('click', closeMenu);
    });

    // Close menu on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && menuBtn.getAttribute('aria-expanded') === 'true') {
        closeMenu();
        menuBtn.focus();
      }
    });
  }

  // Run on initial load
  initHeader();

  // Re-run after Astro View Transitions navigation
  document.addEventListener('astro:after-swap', initHeader);
</script>
